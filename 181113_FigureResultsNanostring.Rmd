---
title: "Figure Papier Adam12: Nanostring Global Results"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '3'
  html_notebook:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

#Introduction
Ce notebook explique comment générer les figures relatives aux données processées de screen Nanostring. 
Il fait suite aux analyses d'Oli: se référer à ses notebooks pour comprendre comment les données ont été normalisées.

L'objectif est de réaliser un stripchart mettant en évidance l'induction d'Adam12 par Tak1, et Tak1 seulement, suite au screen Kinases activées. Même graphique pour le screen siRNA. 

Le premier onglet initialise les Pathways (à modifier selon machine), les librairies, les fonctions personnelles et les données. 

Les onglets suivants décrivent la définition des FC, et la construction des graphiques. 

##Path
```{r}

pathData = "C:/Users/marth/Desktop/These_Marthe/1_Bioinfo/181113_Oli_figures-for-paper"

pathRes = "C:/Users/marth/Desktop/These_Marthe/1_Bioinfo/181113_Oli_figures-for-paper/ResultMarthe"

```


##Librairies
```{r}

library(psych)

library(ggplot2)
library(gridExtra)

library(ggrepel)
```


##Données
```{r}
load(paste(pathData, "figNanostring.RData", sep="/"))
```


##Fonctions
```{r}
vecto = function(data) {
                 vec = NULL ; ech = NULL ; gene = NULL ; expr = NULL
                 for (i in 1:ncol(data)) {
                           vec = c(vec, data[,i])
                           ech = c(ech, rep( colnames(data)[i],
length(data[,i])) )
                           gene = rep(row.names(data), ncol(data))
                 }

                 dt = data.frame(vec, ech, gene)
                 dt$ech = factor(dt$ech, levels = colnames(data))
                 dt$gene = factor(dt$gene, levels = rownames(data))

         return( dt )
}


```




-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------





#Exploration données

=> comprendre comment s'organise le bébé. Source : figNanostring.RData

Les deux tableaux sont identiques concernant la structure des lignes. Les colonnes contiennent les différents échantillons IMR90. 

###Index lignes
```{r}
# Probes indexes 
cta<-c(1:42) # Cancer Testis Antigens 
goi<-c(43:54) # Genes of interest 
imp<-c(55:56) # Imprinted genes 
rpt<-c(57:79) # Repeated elements 
hsk<-c(83:86) # House keeping genes (4) 
hskptt<-c(84:86) # HSK -B2M 
hsktt<-c(85:86) # HSK -B2M &PGK1 
hskbpt<-c(83:85) # HSK -TUB2A 
pos<-c(95:100) # Nanostring spike-in positive controls 
neg<-c(87:94) # Nanostring negative controls 
myr= 80 # myr-tag probe (in fusion with activated kinases) 
neo=81 # Neomycin resistance probe (kinase screen) 
puro=82 # Puromycin resistance probe (kinase screen)

# Familly indexes 
allgoi2 <- c(goi,imp,rpt,hsk) 
allg <- c(cta,goi,imp,rpt,hsk,pos) 
allgoi <- c(goi,imp)
```


##Index colonnes Kinases
```{r}
dim(allNphbptk)
```
C'est un tableau CT en lignes, kinases et controles en colonnes, contenant les valeurs d'expression normalisées. 

Cf. Oli pour le choix de la normalisation, j'ai repris les datas à partir desquelles il a représenté les figures V1. 

NB: ne semble pas être la même normalisation pour les deux set de données (siRNA / kinases).


```{r}
# sample indexes
ctnegk <- grep("IMR", colnames(allNphbptk))      # Negative controls
sw <-grep("SW", colnames(allNphbptk))            # Posivite controls (SW39 cells)
db <-c(6:11)                                  # Replicated samples
```


```{r}
#2 réplicats techniques pour les kinases
IMR_R2=apply(allNphbptk[cta, c(2, 3)], 1, mean)

#On choisit les données : on prend la moyenne des deux réplicats techniques, on ne prend pas les sw
Expr_nomr_kinase = cbind(IMR_R1=allNphbptk[cta,  1],
                         IMR_R2=IMR_R2,
                         allNphbptk[cta,  c(6:dim(allNphbptk)[2])])
#View(Expr_nomr_kinase)
dim(Expr_nomr_kinase)
ctnegk <- grep("IMR", colnames(Expr_nomr_kinase))      # Negative controls

head(Expr_nomr_kinase)
```








##Index colonnes SiRNA
```{r}
dim(allNphbptsi)
```

Même genre de tableau, CT en ligne et siRNA en colonnes. 


```{r}
#siRNA raw data contains additional samples from the kinase screen
# pbabe sample and Map3K7 replicate removed from siRNA serie
# pBABE samples, pbabe <- c(1:8)
# Map3k7 sample, ctMK7<-c(22)

# Nanostring positive control for siRNA
colnames(allNphbptsi)[colnames(allNphbptsi) %in%  rownames(allNphbptsi)]
```

```{r}
# Indexes redefined for normalized counts
ctnegsin <-  grep("Ctrl.neg", colnames(allNphbptsi))        # Negative controls on norm data

# Nanostring positive control for siRNA index on norm data
ctDNMTn <- grep("DNMT1", colnames(allNphbptsi))             # siRNA Positive controls for DNMT1
ctTETn <- grep("TET", colnames(allNphbptsi))                # siRNA Positive controls for TET1 & TET3
ctZBTBn <- c(grep("ZBTB3", colnames(allNphbptsi)),
              which(colnames(allNphbptsi) == "ZBTB4") )    # siRNA Positive controls for ZBTB33 & ZBTB38
ctPPMD1n <- grep("PPM1D", colnames(allNphbptsi))            # siRNA Positive controls for PPMD1
ctUHRF1n <- grep("UHRF1", colnames(allNphbptsi))            # siRNA Positive controls for UHRF1

ctposn <- c(ctDNMTn, ctTETn, ctZBTBn, ctUHRF1n, ctPPMD1n)      # siRNA Positive controls (all)
```


```{r}
#on choisit les données : on ne garde que les CTA
Expr_nomr_si = allNphbptsi[cta, ]
#View(Expr_nomr_si)
head(Expr_nomr_si)
```



------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------


#Statistiques & formatage

=>  On a deux groupes : kinase (resp. si) vs controle. 
=> Pour chaque groupe, on calcule la médiane ;
=> Pour chaque groupe, on calcule un FC en divisant par cette médiane ; 
=> Pour chaque groupe, on calcule la SD associée. 

##Kinases
```{r}
## Compute median expression of all and negative controls

medk = apply(Expr_nomr_kinase[,], 1, median )
med_ctlk = apply(Expr_nomr_kinase[,ctnegk], 1, median )
mean_ctlk = apply(Expr_nomr_kinase[,ctnegk], 1, mean )

sdk = apply(Expr_nomr_kinase[,], 1, sd )
sd_control_k = apply(Expr_nomr_kinase[,ctnegk], 1, sd )

sd_med_k = apply(log2(Expr_nomr_kinase[,]/medk), 1, sd )
sd_med_control_k = apply(log2(Expr_nomr_kinase[,ctnegk]/med_ctlk), 1, sd )


## Vectorize normalized counts, fold change over geomean and fold change over median
exprk = vecto(Expr_nomr_kinase[,])
fcmexprk = vecto(log2(Expr_nomr_kinase[,]/medk))

fcmexpr_ctlk = vecto(log2(Expr_nomr_kinase[,]/med_ctlk))

## create an annotation vector sample type
typek = c( rep("Untransfected",2*dim(Expr_nomr_kinase)[1]) ,
           rep("Kinases", 191*dim(Expr_nomr_kinase)[1]))

## Combine all informations in one dataframe

exprk = data.frame(exprk, type = typek, 
                   fcmed = fcmexprk$vec, fcmexpr_ctl=fcmexpr_ctlk$vec,
                   sd =sdk, sd_control = sd_control_k, 
                   sd_med = sd_med_k , sd_med_control = sd_med_control_k)


head(exprk)
```

##siRNA

```{r}
## Computemedian expression of samples (resp. negative controls)

medsi = apply(Expr_nomr_si[cta,], 1, median )
med_ctlsi = apply(Expr_nomr_si[cta,ctnegsin], 1, median )
mean_ctlsi = apply(Expr_nomr_si[cta,ctnegsin], 1, mean )

sdsi = apply(Expr_nomr_si[cta,], 1, sd )
sd_control_si = apply(Expr_nomr_si[cta,ctnegsin], 1, sd )

sd_med_si = apply(log2(Expr_nomr_si[cta,]/medsi), 1, sd )
sd_med_control_si = apply(log2(Expr_nomr_si[cta,ctnegsin]/med_ctlsi), 1, sd )


## Vectorize normalized counts, fold change over geomean and fold change over median
exprsi = vecto(Expr_nomr_si[cta,])
fcmexprsi = vecto(log2(Expr_nomr_si[cta,]/medsi))

fcmexpr_ctlsi = vecto(log2(Expr_nomr_si[cta,]/med_ctlsi))

## create an annotation vector sample type

## create an annotation vector sample type

typesi = c(rep("siCtrl", 4*nrow(Expr_nomr_si[cta,])), rep("siRNA", 163*nrow(Expr_nomr_si[cta,])))

sict = c( rep("sictrlneg", 4*nrow(Expr_nomr_si[cta,])), 
          rep("sictrlpos", 9*nrow(Expr_nomr_si[cta,])),
          rep("siRNA", 111*nrow(Expr_nomr_si[cta, ])),
          rep("sictrlpos", 1*nrow(Expr_nomr_si[cta,])),
          rep("siRNA", 26*nrow(Expr_nomr_si[cta,])),
          rep("sictrlpos", 1*nrow(Expr_nomr_si[cta,])),
          rep("siRNA", 15*nrow(Expr_nomr_si[cta,])))

## Combine all informations in one dataframe

exprsi= data.frame(exprsi, type = typesi, 
                  fcmed = fcmexprsi$vec, fcmexpr_ctl=fcmexpr_ctlsi$vec,
                   sd =sdsi, sd_control=sd_control_si, 
                  sd_med = sd_med_si, sd_med_control = sd_med_control_si)


head(exprsi)
```




------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------


#Stripchart SD en FC

##Kinases
```{r}
head(exprk)

```


### 2 échelles superposées pour y: FC Ctl et FC Kinases

```{r}
# extract data for ggreplel  
ik = subset(exprk, ech == "MAP3K7" & gene == "ADAM12")
# rename MAP3K7 on TAK1
ik[,2] = "TAK1" 

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_k=rep(sd_med_control_k, 2)


#Plot : superposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose TAK1 / ADAM12

ggplot( data = exprk, 
              aes(x = gene , 
                  y = fcmed, color = type))  +
          scale_color_manual(values=c( "orange", "black"))+
  
          geom_hline(aes(yintercept=0),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprk, type %in% c("Kinases")),
              aes(x = gene , 
                  y = fcmed,
                  color="Kinases"), size=3, shape=19) +

          geom_point( data  = subset(exprk, type %in% c("Untransfected")), 
                       aes(x = gene, 
                           y = fcmexpr_ctl,
                           color="Untransfected"), size=3, shape=19) +
          geom_errorbar(data  = subset(exprk, type %in% c("Untransfected")),
                        aes(ymin=0-Bar_err_k, 
                            ymax=0+Bar_err_k), colour="black", width=1) +
  
          geom_point(data = subset(exprk , (ech == "MAP3K7") & (gene == "ADAM12")), 
                      aes( shape = "TAK1 on ADAM12" ), color = "red ",  size = 3)+
          geom_text_repel(data = ik,   
                          aes(x= gene, y = fcmed , label = ech), 
                           color="red", size = 4, max.iter = 5000, 
                          box.padding=0, segment.alpha=0,   
                          direction="y", nudge_y = 10 )+    #bouger verticalement
  
          scale_x_discrete(limits=names(sd_med_control_k[order(-sd_med_control_k)]))+
          scale_y_continuous(limits=c(-4, 4)) +
          labs(shape = "Kinase", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Kinases \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=12),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 10),
              axis.text.y=element_text(colour="black", size = 10),
        legend.text = element_text(size=12),
        legend.position="right")
```

### Même échelle pour y: FC relatif aux ctls


```{r}
# extract data for ggreplel  
ik = subset(exprk, ech == "MAP3K7" & gene == "ADAM12")
# rename MAP3K7 on TAK1
ik[,2] = "TAK1" 

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_k=rep(sd_med_control_k , 2)


#Plot : superposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose TAK1 / ADAM12

ggplot( data = exprk, 
              aes(x = gene , 
                  y = fcmexpr_ctl, color = type))  +
          scale_color_manual(values=c( "black", "orange", "grey"))+
  
          geom_hline(aes(yintercept=0),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprk, type %in% c("Kinases")),
              aes(x = gene , 
                  y = fcmexpr_ctl,
                  color="Kinases")) +

          geom_point( data  = subset(exprk, type %in% c("Untransfected")), 
                       aes(x = gene, 
                           y = fcmexpr_ctl,
                           color="Controls")) +
          geom_errorbar(data  = subset(exprk, type %in% c("Untransfected")),
                        aes(ymin=-Bar_err_k, 
                            ymax=Bar_err_k, colour="black", width=1)) +
  
          geom_point(data = subset(exprk , (ech == "MAP3K7") & (gene == "ADAM12")), 
                      aes( shape = "TAK1 on ADAM12" ), color = "red ",  size = 2)+
          geom_text_repel(data = ik,   
                          aes(x= gene, y = fcmexpr_ctl , label = ech), 
                           color="red", size = 4, max.iter = 5000, 
                          box.padding=0, segment.alpha=0,   
                          direction="y", nudge_y = 10 )+    #bouger verticalement
  
          scale_x_discrete(limits=names(sd_med_control_k[order(-sd_med_control_k)]))+
     #     scale_y_continuous(limits=c(-1, 4)) +
          labs(shape = "Kinase", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Kinases \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=10),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 6),
              axis.text.y=element_text(colour="black", size = 6),
        legend.text = element_text(size=8),
        legend.position="right")
```









##siRNA




```{r}
head(exprsi)
```

```{r}
summary(exprsi)
```

### 2 échelles pour y

```{r}
# extract data for ggreplel  
ik = subset(exprsi, (ech %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12"))

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_si=rep(sd_med_control_si, 4)


#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose SIRT6 KAT2A / ADAM12

ggplot( data = exprsi, 
              aes(x = gene , 
                  y = fcmed, color = type))  +
          scale_color_manual(values=c( "black", "orange"))+
  
          geom_hline(aes(yintercept=0),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprsi, type %in% c("siRNA")),
              aes(x = gene , 
                  y = fcmed,
                  color="siRNA"), size=3, shape=19) +

          geom_point( data  = subset(exprsi, type %in% c("siCtrl")), 
                       aes(x = gene, 
                           y = fcmexpr_ctl,
                           color="siCtrl"), size=3, shape=19) +
          geom_errorbar(data  = subset(exprsi, type %in% c("siCtrl")),
                        aes(ymin=-Bar_err_si, 
                            ymax=Bar_err_si), colour="black", width=1) +
  
          geom_point(data = subset(exprsi , (ech  %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12")), 
                      aes( shape = "SIRT6 / KAT2A \n on ADAM12" ), color = "red ", size=3)+
          geom_text_repel(data = ik,   
                          aes(x= gene, y = fcmed , label = ech), 
                          #arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),
                          color="red", size = 4, max.iter = 5000,  force = 10,
                          box.padding=0, segment.alpha=1, segment.size=0.2,  
                          direction="both", nudge_y =0.8, nudge_x= c(2.5,0) )+    #bouger verticalement
  
          scale_x_discrete(limits=names(sd_med_control_si[order(-sd_med_control_si)]))+
         scale_y_continuous(limits=c(-4, 4)) +
          labs(shape = "siRNA", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Epigenetic \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=12),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 10),
              axis.text.y=element_text(colour="black", size = 10),
        legend.text = element_text(size=12),
        legend.position="right")
```

### Même échelle pour y

```{r}
# extract data for ggreplel  
ik = subset(exprsi, (ech %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12"))

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_si=rep(log2(sd_med_control_si + 1), 4)


#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose SIRT6 KAT2A / ADAM12

ggplot( data = exprsi, 
              aes(x = gene , 
                  y = log2(fcmexpr_ctl + 1), color = type))  +
          scale_color_manual(values=c( "black", "orange"))+
  
          geom_hline(aes(yintercept=1),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprsi, type %in% c("siRNA")),
              aes(x = gene , 
                  y = log2(fcmexpr_ctl + 1),
                  color="siRNA")) +

          geom_point( data  = subset(exprsi, type %in% c("siCtrl")), 
                       aes(x = gene, 
                           y = log2(fcmexpr_ctl+ 1),
                           color="siCtrl")) +
          geom_errorbar(data  = subset(exprsi, type %in% c("siCtrl")),
                        aes(ymin=1-Bar_err_si, 
                            ymax=1+Bar_err_si), colour="black", width=1) +
  
          geom_point(data = subset(exprsi , (ech  %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12")), 
                      aes( shape = "SIRT6 / KAT2A \n on ADAM12" ), color = "red ",  size = 2)+
          geom_text_repel(data = ik,   
                          aes(x= gene, y = log2(fcmexpr_ctl + 1) , label = ech), 
                          #arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),
                          color="red", size = 4, max.iter = 5000,  force = 10,
                          box.padding=0, segment.alpha=1, segment.size=0.2,  
                          direction="both", nudge_y =0.8, nudge_x= c(2.5,0) )+    #bouger verticalement
  
          scale_x_discrete(limits=names(sd_med_control_si[order(-sd_med_control_si)]))+
          scale_y_continuous(limits=c(-1, 4)) +
          labs(shape = "siRNA", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Epigenetic \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=10),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 6),
              axis.text.y=element_text(colour="black", size = 6),
        legend.text = element_text(size=8),
        legend.position="right")
```



------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------


#Stripchart SD Norm Count

##Kinase

```{r}
# extract data for ggreplel  
ik = subset(exprk, ech == "MAP3K7" & gene == "ADAM12")
# rename MAP3K7 on TAK1
ik[,2] = "TAK1" 

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_k2=rep(sd_control_k, 3)
mean_bar_err_k2=rep(mean_ctlk, 3)

#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose TAK1 / ADAM12

ggplot( data = exprk, 
              aes(x = gene , 
                  y = vec , color = type))  +
          scale_color_manual(values=c( "black", "orange"))+
  
          geom_hline(aes(yintercept=1),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprk, type %in% c("Kinases")),
              aes(x = gene , 
                  y =vec,
                  color="Kinases")) +

          geom_point( data  = subset(exprk, type %in% c("Controls")), 
                       aes(x = gene, 
                           y = vec,
                           color="Controls")) +
          geom_errorbar(data  = subset(exprk, type %in% c("Controls")),
                        aes(ymin=mean_bar_err_k2 -Bar_err_k2, 
                            ymax=mean_bar_err_k2 +Bar_err_k2), colour="black", width=1) +
  
          geom_point(data = subset(exprk , (ech == "MAP3K7") & (gene == "ADAM12")), 
                      aes( shape = "TAK1 on ADAM12" ), color = "red ",  size = 2)+
          geom_text_repel(data = ik,   
                          aes(x= gene, y = log2(vec + 1) , label = ech), 
                           color="red", size = 4, max.iter = 5000, 
                          box.padding=0, segment.alpha=0,   
                          direction="y", nudge_y = 600 )+    #bouger verticalement
  
          scale_x_discrete(limits=names(sd_control_k[order(-sd_control_k)]))+
        #  scale_y_continuous(limits=c(-1, 4)) +
          labs(shape = "Kinase", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Kinases \n TS/PS in IMR90",
               y="Log2 Norm Expression",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=10),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 6),
              axis.text.y=element_text(colour="black", size = 6),
        legend.text = element_text(size=8),
        legend.position="right")
```



##siRNA
```{r}
# extract data for ggreplel  
ik = subset(exprsi, (ech %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12"))

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_si2=rep(sd_control_si, 4)
mean_bar_err_si2=rep(mean_ctlsi, 4)

#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose SIRT6 KAT2A / ADAM12

ggplot( data = exprsi, 
              aes(x = gene , 
                  y = vec, color = type))  +
          scale_color_manual(values=c( "black", "orange"))+
  
          geom_hline(aes(yintercept=1),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprsi, type %in% c("siRNA")),
              aes( color="siRNA")) +

          geom_point( data  = subset(exprsi, type %in% c("siCtrl")), 
                       aes(color="siCtrl")) +
          geom_errorbar(data  = subset(exprsi, type %in% c("siCtrl")),
                        aes(ymin=mean_bar_err_si2-Bar_err_si2, 
                            ymax=mean_bar_err_si2 +Bar_err_si2), colour="black", width=1) +
  
          geom_point(data = subset(exprsi , (ech  %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12")), 
                      aes( shape = "SIRT6 / KAT2A \n on ADAM12" ), color = "red ",  size = 2)+
          geom_text_repel(data = ik,   
                          aes(x= gene, y =vec , label = ech), 
                          #arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),
                          color="red", size = 3, max.iter = 5000,  force = 10,
                          box.padding=0, segment.alpha=1, segment.size=0.2,  
                          direction="both", nudge_y =0.8, nudge_x= c(2.5,0) )+    #bouger verticalement
  
          scale_x_discrete(limits=names(sd_control_si[order(-sd_control_si)]))+
  #        scale_y_continuous(limits=c(-1, 4)) +
          labs(shape = "siRNA", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Epigenetic \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=10),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 6),
              axis.text.y=element_text(colour="black", size = 6),
        legend.text = element_text(size=8),
        legend.position="right")
```



------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
#ADAM12 kinases


```{r}
ik = subset(exprk, ech == "MAP3K7" & gene == "ADAM12")
# rename MAP3K7 on TAK1
ik[,2] = "TAK1" 
ggplot(data = exprk,
       aes(x = factor("") , 
           y = vec, color = type)) +
          scale_color_manual(values=c("orange", "black")) +
  
          geom_jitter(data = subset(exprk, type %in% c( "Kinases") & gene == "ADAM12"),
                      aes(x= factor(""), 
                          y = vec , color = type), position=position_jitter(0.3), size = 3) +
  
          geom_jitter(data = subset(exprk, type %in% c("Untransfected") & gene == "ADAM12"), 
                      aes(x= factor(""), y = vec , color = type), 
                      position=position_jitter(0.2), size = 3) +
  
          labs(colour="") +  
  
          geom_point(data = subset(exprk , (ech == "MAP3K7") & (gene == "ADAM12")), 
                      aes( shape = "TAK1 on ADAM12" ), color = "red ",  size = 3)+
          geom_text_repel(data = ik,   
                          aes(x= factor(""), y = vec , label = ech), 
                           color="red", size = 4, max.iter = 5000, 
                          box.padding=0, segment.alpha=0,   
                          direction="y", nudge_y = 650 )+    #bouger verticalement
  
          labs(shape = "Kinase", color = "Samples", #Renommenr les labels, titres et axes
               title="ADAM12 Expression",
               y="Normalized counts",
               x=" ")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=12),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 10),
              axis.text.y=element_text(colour="black", size = 10),
        legend.text = element_text(size=12),
        legend.position="right")+
  set.seed(3)
```


#ADAM12 siRNA
```{r}
iks = subset(exprsi, ech %in% c("KAT2A", "SIRT6") & gene == "ADAM12")

ggplot(data = exprsi) +
  
          geom_jitter(data = subset(exprsi, type %in% c("siRNA") & gene == "ADAM12"), # extract ADAM12
                      aes(x= factor(""), y = vec , color = type), position=position_jitter(0.3), size=3) +
  
          geom_jitter(data = subset(exprsi, type %in% c("siCtrl") & gene == "ADAM12"), # extract ADAM12
                      aes(x= factor(""), y = vec , color = type) , position=position_jitter(0.1), size=3) +
          scale_color_manual(values=c("black", "orange")) +
  
          labs(colour="") +  
  
          geom_point(data = subset(exprsi , (ech  %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12")), 
                      aes( x= factor(""), y = vec , 
                           shape = "SIRT6 / KAT2A \n on ADAM12" ), color = "red ", size=3)+
          geom_text_repel(data = iks,   
                          aes(x= factor(""), y = vec , label = ech), 
                          #arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),
                          color="red", size = 4, max.iter = 5000,  force = 1,
                          box.padding=0, segment.alpha=1, segment.size=0.1,  
                          direction="both", nudge_y =0.8, nudge_x= c(2.5,0) )+    #bouger verticalement
  
  
          labs(shape = "siRNA", color = "Samples", #Renommenr les labels, titres et axes
               title="ADAM12 Expression",
               y="Normalized counts",
               x=" ")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=12),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 10),
              axis.text.y=element_text(colour="black", size = 10),
        legend.text = element_text(size=12),
        legend.position="right") 
```




