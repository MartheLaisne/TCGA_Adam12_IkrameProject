---
title: "Figure Papier Adam12"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '4'
  html_notebook:
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document:
    toc: yes
    toc_depth: '4'
---

#Introduction

##Path
```{r}

pathData = "C:/Users/marth/Desktop/These_Marthe/1_Bioinfo/181113_Oli_figures-for-paper"

pathRes = "C:/Users/marth/Desktop/These_Marthe/1_Bioinfo/181113_Oli_figures-for-paper/ResultMarthe"

```


##Librairies
```{r}

library(psych)

library(ggplot2)
library(gridExtra)

library(ggrepel)
```


##Données
```{r}
load(paste(pathData, "figNanostring.RData", sep="/"))
```


##Fonctions
```{r}
vecto = function(data) {
                 vec = NULL ; ech = NULL ; gene = NULL ; expr = NULL
                 for (i in 1:ncol(data)) {
                           vec = c(vec, data[,i])
                           ech = c(ech, rep( colnames(data)[i],
length(data[,i])) )
                           gene = rep(row.names(data), ncol(data))
                 }

                 dt = data.frame(vec, ech, gene)
                 dt$ech = factor(dt$ech, levels = colnames(data))
                 dt$gene = factor(dt$gene, levels = rownames(data))

         return( dt )
}

Ma_function_mean = function(X) {
  mean(X, na.rm=T)
}
Ma_function_median = function(X) {
  median(X, na.rm=T)
}


Ma_function_sd = function(X) {
  sd(X, na.rm=T)
}


```




-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------





#Exploration données

=> comprendre comment s'organise le bébé. Source : figNanostring.RData

Les deux tableaux sont identiques concernant la structure des lignes.
###Index lignes
```{r}
# Probes indexes 
cta<-c(1:42) # Cancer Testis Antigens 
goi<-c(43:54) # Genes of interest 
imp<-c(55:56) # Imprinted genes 
rpt<-c(57:79) # Repeated elements 
hsk<-c(83:86) # House keeping genes (4) 
hskptt<-c(84:86) # HSK -B2M 
hsktt<-c(85:86) # HSK -B2M &PGK1 
hskbpt<-c(83:85) # HSK -TUB2A 
pos<-c(95:100) # Nanostring spike-in positive controls 
neg<-c(87:94) # Nanostring negative controls 
myr= 80 # myr-tag probe (in fusion with activated kinases) 
neo=81 # Neomycin resistance probe (kinase screen) 
puro=82 # Puromycin resistance probe (kinase screen)

# Familly indexes 
allgoi2 <- c(goi,imp,rpt,hsk) 
allg <- c(cta,goi,imp,rpt,hsk,pos) 
allgoi <- c(goi,imp)
```


##Index colonnes Kinases
```{r}
dim(allNphbptk)
```
C'est un tableau CT en lignes, kinases et controles en colonnes, contenant les valeurs d'expression normalisées. 

Cf. Oli pour le choix de la normalisation, j'ai repris les datas à partir desquelles il a représenté les figures V1. 

NB: ne semble pas être la même normalisation pour les deux set de données (siRNA / kinases).


```{r}
# sample indexes
ctnegk <- grep("IMR", colnames(allNphbptk))      # Negative controls
sw <-grep("SW", colnames(allNphbptk))            # Posivite controls (SW39 cells)
db <-c(6:11)                                  # Replicated samples
```


```{r}
#2 réplicats techniques pour les kinases
IMR_R2=apply(allNphbptk[cta, c(2, 3)], 1, mean)

#On choisit les données : on prend la moyenne des deux réplicats techniques, on ne prend pas les sw
Expr_nomr_kinase = cbind(IMR_R1=allNphbptk[cta,  1],
                         IMR_R2=IMR_R2,
                         allNphbptk[cta,  c(6:dim(allNphbptk)[2])])
#View(Expr_nomr_kinase)
dim(Expr_nomr_kinase)
ctnegk <- grep("IMR", colnames(Expr_nomr_kinase))      # Negative controls

head(Expr_nomr_kinase)
```








##Index colonnes SiRNA
```{r}
dim(allNphbptsi)
```

Même genre de tableau, CT en ligne et siRNA en colonnes. 


```{r}
#siRNA raw data contains additional samples from the kinase screen
# pbabe sample and Map3K7 replicate removed from siRNA serie
# pBABE samples, pbabe <- c(1:8)
# Map3k7 sample, ctMK7<-c(22)

# Nanostring positive control for siRNA
colnames(allNphbptsi)[colnames(allNphbptsi) %in%  rownames(allNphbptsi)]
```

```{r}
# Indexes redefined for normalized counts
ctnegsin <-  grep("Ctrl.neg", colnames(allNphbptsi))        # Negative controls on norm data

# Nanostring positive control for siRNA index on norm data
ctDNMTn <- grep("DNMT1", colnames(allNphbptsi))             # siRNA Positive controls for DNMT1
ctTETn <- grep("TET", colnames(allNphbptsi))                # siRNA Positive controls for TET1 & TET3
ctZBTBn <- c(grep("ZBTB3", colnames(allNphbptsi)),
              which(colnames(allNphbptsi) == "ZBTB4") )    # siRNA Positive controls for ZBTB33 & ZBTB38
ctPPMD1n <- grep("PPM1D", colnames(allNphbptsi))            # siRNA Positive controls for PPMD1
ctUHRF1n <- grep("UHRF1", colnames(allNphbptsi))            # siRNA Positive controls for UHRF1

ctposn <- c(ctDNMTn, ctTETn, ctZBTBn, ctUHRF1n, ctPPMD1n)      # siRNA Positive controls (all)
```


```{r}
#on choisit les données : on ne garde que les CTA
Expr_nomr_si = allNphbptsi[cta, ]
#View(Expr_nomr_si)
head(Expr_nomr_si)
```



-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------


#Statistiques & formatage

=>  On a deux groupes : kinase (resp. si) vs controle. 
=> Pour chaque groupe, on calcule la médiane ;
=> Pour chaque groupe, on calcule un FC en divisant par cette médiane ; 
=> Pour chaque groupe, on calcule la SD associée. 

##Kinases
```{r}
#A cause du log, attention aux zeros
Expr_nomr_kinase2 = Expr_nomr_kinase
Expr_nomr_kinase2[Expr_nomr_kinase2 == 0] <- NA
## Compute median expression of all and negative controls

medk = apply(Expr_nomr_kinase2[,], 1, Ma_function_median )
med_ctlk = apply(Expr_nomr_kinase2[,ctnegk], 1, Ma_function_median )

sdk = apply(Expr_nomr_kinase2[,], 1, Ma_function_sd )
sd_control_k = apply(Expr_nomr_kinase2[,ctnegk], 1, Ma_function_sd )

sd_med_k = apply(Expr_nomr_kinase2[,]/medk, 1, Ma_function_sd )
sd_med_control_k = apply(Expr_nomr_kinase2[,ctnegk]/med_ctlk, 1, Ma_function_sd )


## Vectorize normalized counts, fold change over geomean and fold change over median
exprk = vecto(Expr_nomr_kinase2[,])
fcmexprk = vecto(Expr_nomr_kinase2[,]/medk) #Data en log2

fcmexpr_ctlk = vecto(Expr_nomr_kinase2[,]/med_ctlk)

## create an annotation vector sample type
typek = c( rep("Untransfected",2*dim(Expr_nomr_kinase2)[1]) ,
           rep("Kinases", 191*dim(Expr_nomr_kinase2)[1]))

## Combine all informations in one dataframe

exprk = data.frame(exprk, type = typek, 
                   fcmed = log2(fcmexprk$vec), fcmexpr_ctl=log2(fcmexpr_ctlk$vec),
                   sd = log2(sdk), sd_control = log2(sd_control_k), 
                   sd_med = log2(sd_med_k) , sd_med_control = log2(sd_med_control_k))


head(exprk)
```

###Seuil Oli

####Test Norm


On teste la normalité des ditributions

```{r}
Test_norm = apply(log2(Expr_nomr_kinase2), 1, shapiro.test )

Compteur = 0 #compte les distributions normales (42 gènes)
Names_Non_norm = NULL

for (i in seq(1, length(Test_norm))) {
  if (Test_norm[[i]]$p.value<0.05) {
    print(Test_norm[i])
    Names_Non_norm = c(Names_Non_norm, names(Test_norm[i]))
  } else {
    Compteur = Compteur +1
  }
}

Compteur
Names_Non_norm
```
==> Les FC suivent une loi normale
==> On a quand même des distributions non normales... 


#### Threshold

```{r}
#A cause du log, attention aux zeros
Expr_nomr_kinase2 = Expr_nomr_kinase
Expr_nomr_kinase2[Expr_nomr_kinase2 == 0] <- NA

#On calcule mean, sd et qnorm(0.99)
mean_k = apply(log2(Expr_nomr_kinase2[,]), 1, Ma_function_mean )

sd_FC_k = apply(log2(Expr_nomr_kinase2[,]), 1, Ma_function_sd )

qnorm_k = qnorm(0.99, lower.tail = T) * sd_FC_k # 99.7 % de taux d'erreur est eq à 3*SD
qnorm_k_plus = qnorm(0.9999, lower.tail = T) * sd_FC_k

#Pour mettre le thr à la même échelle que les log FC, on le divise par la médiane
#et on prend le log du résultat
thr_k = log2(2^(mean_k + qnorm_k)/medk)
thr_k_plus = log2(2^(mean_k + qnorm_k_plus)/medk)

#Pour ADAM12
thr_A12 = 2^(mean_k[names(mean_k) == "ADAM12"] + qnorm_k[names(qnorm_k)=="ADAM12"])
thr_A12_plus = 2^(mean_k[names(mean_k) == "ADAM12"] + qnorm_k_plus[names(qnorm_k_plus)=="ADAM12"])

#on ajoute cette info au tableau
exprk = data.frame(exprk, 
                   thr = rep(thr_k, 193 ),
                   thr_plus = rep(thr_k_plus, 193))
head(exprk)
```

Quelles sont les kinases au dessus du threshold ? 
```{r}
exprk[which(exprk$fcmed > exprk$thr), c("gene","ech","fcmed",  "thr", "thr_plus")]
```

```{r}
exprk[which(exprk$fcmed > exprk$thr_plus), c("gene","ech","fcmed",  "thr", "thr_plus")]

```


```{r}
paste("Ce gène n'a pas une distribution normale et est induit:",
      Names_Non_norm[which(is.element(Names_Non_norm, 
                                      exprk[which(exprk$fcmed > exprk$thr), 
                                            c("gene","ech","fcmed",  "thr")]$gene)==TRUE)])


paste("Ce gène n'a pas une distribution normale mais n'est pas induit:",
      Names_Non_norm[which(is.element(Names_Non_norm, 
                                      exprk[which(exprk$fcmed > exprk$thr), 
                                            c("gene","ech","fcmed",  "thr")]$gene)==FALSE)])
```






##siRNA

```{r}
Expr_nomr_si2 = Expr_nomr_si
Expr_nomr_si2[Expr_nomr_si2 == 0] <- NA

## Computemedian expression of samples (resp. negative controls)

medsi = apply(Expr_nomr_si2[cta,], 1, Ma_function_median )
med_ctlsi = apply(Expr_nomr_si2[cta,ctnegsin], 1, Ma_function_median )

sdsi = apply(Expr_nomr_si2[cta,], 1, Ma_function_sd )
sd_control_si = apply(Expr_nomr_si2[cta,ctnegsin], 1, Ma_function_sd )

sd_med_si = apply(Expr_nomr_si2[cta,]/medsi, 1, Ma_function_sd )
sd_med_control_si = apply(Expr_nomr_si2[cta,ctnegsin]/med_ctlsi, 1, Ma_function_sd )


## Vectorize normalized counts, fold change over geomean and fold change over median
exprsi = vecto(Expr_nomr_si[cta,])
fcmexprsi = vecto((Expr_nomr_si[cta,]/medsi))

fcmexpr_ctlsi = vecto((Expr_nomr_si[cta,]/med_ctlsi))

## create an annotation vector sample type

## create an annotation vector sample type

typesi = c(rep("siCtrl", 4*nrow(Expr_nomr_si[cta,])), rep("siRNA", 163*nrow(Expr_nomr_si[cta,])))

sict = c( rep("sictrlneg", 4*nrow(Expr_nomr_si[cta,])), 
          rep("sictrlpos", 9*nrow(Expr_nomr_si[cta,])),
          rep("siRNA", 111*nrow(Expr_nomr_si[cta, ])),
          rep("sictrlpos", 1*nrow(Expr_nomr_si[cta,])),
          rep("siRNA", 26*nrow(Expr_nomr_si[cta,])),
          rep("sictrlpos", 1*nrow(Expr_nomr_si[cta,])),
          rep("siRNA", 15*nrow(Expr_nomr_si[cta,])))

## Combine all informations in one dataframe

exprsi= data.frame(exprsi, type = typesi, 
                  fcmed = log2(fcmexprsi$vec), fcmexpr_ctl = log2(fcmexpr_ctlsi$vec),
                   sd = log2(sdsi), sd_control= log2(sd_control_si), 
                  sd_med = log2(sd_med_si), sd_med_control = log2(sd_med_control_si))


head(exprsi)
```

###Seuil Oli

####Test Norm 
```{r}
Test_norm = apply(log2(Expr_nomr_si2), 1, shapiro.test )

Compteur = 0 #compte les distributions normales (42 gènes)
Names_Non_norm = NULL

for (i in seq(1, length(Test_norm))) {
  if (Test_norm[[i]]$p.value<0.05) {
    print(Test_norm[i])
    Names_Non_norm = c(Names_Non_norm, names(Test_norm[i]))
  } else {
    Compteur = Compteur +1
  }
}

Compteur
Names_Non_norm
```

####Thr

```{r}

#A cause du log, attention aux zeros
Expr_nomr_si2 = Expr_nomr_si
Expr_nomr_si2[Expr_nomr_si2 == 0] <- NA

#On calcule mean, sd et qnorm(0.99)
mean_si = apply(log2(Expr_nomr_si2[,]), 1, Ma_function_mean )

sd_FC_si = apply(log2(Expr_nomr_si2[,]), 1, Ma_function_sd )

qnorm_si = qnorm(0.99, lower.tail = T) * sd_FC_si
qnorm_si_plus = qnorm(0.9999, lower.tail = T) * sd_FC_si

thr_si = log2(2^(mean_si + qnorm_si)/medsi)
thr_si_plus = log2(2^(mean_si + qnorm_si_plus)/medsi)

#Pour ADAM12
thr_A12_si = 2^(mean_si[names(mean_si) == "ADAM12"] + qnorm_si[names(qnorm_si)=="ADAM12"])
thr_A12_si_plus = 2^(mean_si[names(mean_si) == "ADAM12"] +
                       qnorm_si_plus[names(qnorm_si_plus)=="ADAM12"])


#On ajoute cette information au tableau
exprsi = data.frame(exprsi,
                    thr = rep(thr_si, 167),
                    thr_plus = rep(thr_si_plus, 167))
head(exprsi)
```

Quels sont les si au dessus du thr ? 
```{r}
exprsi[which(exprsi$fcmed > exprsi$thr), c("gene","ech","fcmed",  "thr", "thr_plus")]

```
```{r}
exprsi[which(exprsi$fcmed > exprsi$thr_plus), c("gene","ech","fcmed",  "thr", "thr_plus")]

```





-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------


#Stripchart SD en FC

##Kinases
```{r}
head(exprk)

```


###Compare Controls

```{r}
# extract data for ggreplel  
ik = subset(exprk, ech == "MAP3K7" & gene == "ADAM12")
# rename MAP3K7 on TAK1
ik[,2] = "TAK1" 

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_k=rep(sd_med_control_k, 2)

#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose TAK1 / ADAM12

ggplot( data = exprk, 
              aes(x = gene , 
                  y = fcmed, color = type))  +
          scale_color_manual(values=c( "orange", "black"))+
  
          geom_hline(aes(yintercept=0),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprk, type %in% c("Kinases")),
              aes(x = gene , 
                  y = fcmed,
                  color="Kinases"), size=3, shape=19) +

          geom_point( data  = subset(exprk, type %in% c("Untransfected")), 
                       aes(x = gene, 
                           y = fcmexpr_ctl,
                           color="Untransfected"), size=3, shape=19) +
          geom_errorbar(data  = subset(exprk, type %in% c("Untransfected")),
                        aes(ymin=0-Bar_err_k, 
                            ymax=0+Bar_err_k), colour="black", width=1) +
  
          geom_point(data = subset(exprk , (ech == "MAP3K7") & (gene == "ADAM12")), 
                      aes( shape = "TAK1 on ADAM12" ), color = "red ",  size = 3)+
          geom_text_repel(data = ik,   
                          aes(x= gene, y = fcmed , label = ech), 
                           color="red", size = 4, max.iter = 5000, 
                          box.padding=0, segment.alpha=0,   
                          direction="y", nudge_y = 10 )+    #bouger verticalement
  
          scale_x_discrete(limits=names(sd_med_control_k[order(-sd_med_control_k)]))+
          scale_y_continuous(limits=c(-4, 4)) +
          labs(shape = "Kinase", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Kinases \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=12),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 10),
              axis.text.y=element_text(colour="black", size = 10),
        legend.text = element_text(size=12),
        legend.position="right")
```

```{r}

```



### Compare distribution, thr 1%


```{r}
# extract data for ggreplel  
ik = subset(exprk, ech == "MAP3K7" & gene == "ADAM12")
# rename MAP3K7 on TAK1
ik[,2] = "TAK1" 

Bar_err_k = exprk$thr


#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose TAK1 / ADAM12

ggplot( data = exprk, 
              aes(x = gene , 
                  y = fcmed, color = type))  +
          scale_color_manual(values=c( "black", "orange", "black"))+
  
          geom_hline(aes(yintercept=0), color="black", linetype="solid", size=0.5)+
  
          geom_jitter(data  = subset(exprk, (type %in% c("Kinases")) & (fcmed < thr)),
              aes(x = gene , y = fcmed, color="Kinases"), size=3, shape=19, width = 0.2) +
          geom_point(data  = subset(exprk, (type %in% c("Kinases"))  & (fcmed > thr) ),
              aes(x = gene , y = fcmed, color="Kinases"), size=3, shape=19) +

         geom_point( data  = subset(exprk, type %in% c("Untransfected")), aes(x = gene,  y = fcmed,
                           color="Controls"), size=3, shape=19) +
          
         geom_errorbar(aes(ymin= 0, 
                            ymax=Bar_err_k, color = "Threshold 1%"), width=1, size=1) +
         
          geom_point(data = subset(exprk , (ech == "MAP3K7") & (gene == "ADAM12")), 
                      aes( shape = "TAK1 on ADAM12" ), color = "red ", size=3, shape=19)+
          geom_text_repel(data = ik, aes(x= gene, y = fcmed , label = ech),  color="red", size = 4,
                          max.iter = 5000, box.padding=0, segment.alpha=0, direction="y", 
                          nudge_y = 1)+    #bouger verticalement
  
          scale_x_discrete(limits=names(thr_k[order(-thr_k)]))+
          scale_y_continuous(limits=c(-5, 5)) +

            labs(shape = "Kinase", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Kinases \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=10),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 6),
              axis.text.y=element_text(colour="black", size = 6),
        legend.text = element_text(size=8),
        legend.position="right")

```


###Compare distrib, thr 0.3%
```{r}
# extract data for ggreplel  
ik = subset(exprk, ech == "MAP3K7" & gene == "ADAM12")
# rename MAP3K7 on TAK1
ik[,2] = "TAK1" 

Bar_err_k = exprk$thr
Bar_err_k_plus = exprk$thr_plus


#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose TAK1 / ADAM12

ggplot( data = exprk, 
              aes(x = gene , 
                  y = fcmed, color = type))  +
          scale_color_manual(values=c( "black", "orange", "black", "black"))+
  
          geom_hline(aes(yintercept=0), color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprk, (type %in% c("Kinases")) & (fcmed < thr_k_plus)),
              aes(x = gene , y = fcmed, color="Kinases"), size=2, shape=19) +
         geom_point(data  = subset(exprk, (type %in% c("Kinases"))  & (fcmed > thr_k_plus) ),
              aes(x = gene , y = fcmed, color="Kinases"), size=3, shape=19) +

          geom_point( data  = subset(exprk, type %in% c("Untransfected")), aes(x = gene,  y = fcmed,
                           color="Controls"), size=3, shape=19) +
          
        geom_errorbar(aes(ymin= 0,ymax=Bar_err_k, color = "Threshold 1%"), width=1, size=0.2) +
        geom_errorbar(aes(ymin= 0,ymax=Bar_err_k_plus, color = "Threshold 0.01%"), width=1, size=1) +
         
          geom_point(data = subset(exprk , (ech == "MAP3K7") & (gene == "ADAM12")), 
                      aes( shape = "TAK1 on ADAM12" ), color = "red ", size=3, shape=19)+
          geom_text_repel(data = ik, aes(x= gene, y = fcmed , label = ech),  color="red", size = 4,
                          max.iter = 5000, box.padding=0, segment.alpha=0, direction="y", 
                          nudge_y = 1)+    #bouger verticalement
  
          scale_x_discrete(limits=names(thr_k[order(-thr_k)]))+
          scale_y_continuous(limits=c(-5, 5)) +

            labs(shape = "Kinase", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Kinases \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=10),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 6),
              axis.text.y=element_text(colour="black", size = 6),
        legend.text = element_text(size=8),
        legend.position="right")
```







##siRNA




```{r}
head(exprsi)
```

```{r}
summary(exprsi)
```

### Compare Ctl

```{r}
# extract data for ggreplel  
ik = subset(exprsi, (ech %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12"))

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_si=rep(sd_med_control_si, 4)


#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose SIRT6 KAT2A / ADAM12

ggplot( data = exprsi, 
              aes(x = gene , 
                  y = fcmed, color = type))  +
          scale_color_manual(values=c( "black", "orange"))+
  
          geom_hline(aes(yintercept=0),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprsi, type %in% c("siRNA")),
              aes(x = gene , 
                  y = fcmed,
                  color="siRNA"), size=3, shape=19) +

          geom_point( data  = subset(exprsi, type %in% c("siCtrl")), 
                       aes(x = gene, 
                           y = fcmexpr_ctl,
                           color="siCtrl"), size=3, shape=19) +
          geom_errorbar(data  = subset(exprsi, type %in% c("siCtrl")),
                        aes(ymin=-Bar_err_si, 
                            ymax=Bar_err_si), colour="black", width=1) +
  
          geom_point(data = subset(exprsi , (ech  %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12")), 
                      aes( shape = "SIRT6 / KAT2A \n on ADAM12" ), color = "red ", size=3)+
          geom_text_repel(data = ik,   
                          aes(x= gene, y = fcmed , label = ech), 
                          #arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),
                          color="red", size = 4, max.iter = 5000,  force = 10,
                          box.padding=0, segment.alpha=1, segment.size=0.2,  
                          direction="both", nudge_y =0.8, nudge_x= c(2.5,0) )+    #bouger verticalement
  
          scale_x_discrete(limits=names(sd_med_control_si[order(-sd_med_control_si)]))+
         scale_y_continuous(limits=c(-4, 4)) +
          labs(shape = "siRNA", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Epigenetic \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=12),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 10),
              axis.text.y=element_text(colour="black", size = 10),
        legend.text = element_text(size=12),
        legend.position="right")
```

### Compare Distribution thr 1%

```{r}
# extract data for ggreplel  
ik = subset(exprsi, (ech %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12"))

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_si=exprsi$thr


#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose SIRT6 KAT2A / ADAM12

ggplot(data = exprsi, 
              aes(x = gene , 
                  y = fcmed, color = type))  +
          scale_color_manual(values=c( "black","orange", "black"))+
  
          geom_hline(aes(yintercept=0),   
               color="black", linetype="solid", size=0.5)+
  
          geom_jitter(data  = subset(exprsi, (type %in% c("siRNA")) & (fcmed < thr)),
              aes(x = gene , y = fcmed, color="siRNA"), size=3, shape=19, width = 0.1) +
         geom_point(data  = subset(exprsi, (type %in% c("siRNA"))  & (fcmed > thr) ),
              aes(x = gene , y = fcmed, color="siRNA"), size=3, shape=19) +

          geom_point( data  = subset(exprsi, type %in% c("siCtrl")), 
                       aes(x = gene,  y = fcmed, color="siCtrl"), size = 3, shape = 19) +
          
  geom_errorbar(data = exprsi, 
                        aes(ymin=0, 
                            ymax=Bar_err_si, color = "Threshold 1%"), width=1, size = 1)  +
  
          geom_point(data = subset(exprsi , (ech  %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12")), 
                      aes( shape = "SIRT6 / KAT2A \n on ADAM12" ), color = "red ",  size = 3, shape = 19)+
   geom_text_repel(data = ik,   
                          aes(x= gene, y = fcmed , label = ech), 
                          #arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),
                          color="red", size = 4, max.iter = 5000,  force = 10,
                          box.padding=0, segment.alpha=1, segment.size=0.2,  
                          direction="both", nudge_y =1.5, nudge_x= c(2.5,0) )+    #bouger verticalement


          scale_x_discrete(limits=names(thr_si[order(-thr_si)]))+
          scale_y_continuous(limits=c(-5, 5)) +
          labs(shape = "siRNA", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Epigenetic \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=10),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 6),
              axis.text.y=element_text(colour="black", size = 6),
        legend.text = element_text(size=8),
        legend.position="right")
```

###Compare distribution thr 0.3 % 
```{r}
# extract data for ggreplel  
ik = subset(exprsi, (ech %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12"))

#On génère les barres d'erreurs pour les ech controles, n = nb ech ctl
Bar_err_si=exprsi$thr
Bar_err_si_plus=exprsi$thr_plus


#Plot : supperposition de samples kinases (orange) et samples ctl (noir) + Barre d'erreurs (SD), 
# ENfin suppers=pose SIRT6 KAT2A / ADAM12

ggplot(data = exprsi, 
              aes(x = gene , 
                  y = fcmed, color = type))  +
          scale_color_manual(values=c( "black","orange", "black", "black"))+
  
          geom_hline(aes(yintercept=0),   
               color="black", linetype="solid", size=0.5)+
  
          geom_point(data  = subset(exprsi, (type %in% c("siRNA")) & (fcmed < thr_plus)),
              aes(x = gene , y = fcmed, color="siRNA"), size=2, shape=19) +
         geom_point(data  = subset(exprsi, (type %in% c("siRNA"))  & (fcmed > thr_plus) ),
              aes(x = gene , y = fcmed, color="siRNA"), size=3, shape=19) +

          geom_point( data  = subset(exprsi, type %in% c("siCtrl")), 
                       aes(x = gene,  y = fcmed, color="siCtrl"), size = 3, shape = 19) +
          
  geom_errorbar(aes(ymin=0,ymax=Bar_err_si, color = "Threshold 1%"), width=1, size = 0.2)  +
  geom_errorbar(aes(ymin=0,ymax=Bar_err_si_plus, color = "Threshold 0.01%"), width=1, size = 1)  +
  
          geom_point(data = subset(exprsi , (ech  %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12")), 
                      aes( shape = "SIRT6 / KAT2A \n on ADAM12" ), color = "red ",  size = 3, shape = 19)+
   geom_text_repel(data = ik,   
                          aes(x= gene, y = fcmed , label = ech), 
                          #arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),
                          color="red", size = 4, max.iter = 5000,  force = 10,
                          box.padding=0, segment.alpha=1, segment.size=0.2,  
                          direction="both", nudge_y =1.5, nudge_x= c(2.5,0) )+    #bouger verticalement


          scale_x_discrete(limits=names(thr_si[order(-thr_si)]))+
          scale_y_continuous(limits=c(-5, 5)) +
          labs(shape = "siRNA", color = "Samples", #Renommenr les labels, titres et axes
               title="Nanostring Screen Epigenetic \n TS/PS in IMR90",
               y="Log2 Fold Change (Median) ",
               x="TS/PS targeted")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=10),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 6),
              axis.text.y=element_text(colour="black", size = 6),
        legend.text = element_text(size=8),
        legend.position="right")
```




-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------
#ADAM12 kinases


```{r}
ik = subset(exprk, ech == "MAP3K7" & gene == "ADAM12")
# rename MAP3K7 on TAK1
ik[,2] = "TAK1" 
ggplot(data = exprk,
       aes(x = factor("") , 
           y = vec, color = type)) +
          scale_color_manual(values=c("orange", "black")) +
  
          geom_jitter(data = subset(exprk, type %in% c( "Kinases") & gene == "ADAM12" & ech != "MAP3K7"),
                      aes(x= factor(""), 
                          y = vec , color = type), position=position_jitter(0.3), size = 3) +
  
          geom_jitter(data = subset(exprk, type %in% c("Untransfected") & gene == "ADAM12"), 
                      aes(x= factor(""), y = vec , color = type), 
                      position=position_jitter(0.2), size = 3) +
  
  geom_hline(yintercept = thr_A12, color = "black", linetype = "dashed")+
  geom_hline(yintercept = thr_A12_plus, color = "black", size= 2)+
  
          labs(colour="") +  
  
          geom_point(data = subset(exprk , (ech == "MAP3K7") & (gene == "ADAM12")), 
                      aes( shape = "TAK1 on ADAM12" ), color = "red ",  size = 3)+
          geom_text_repel(data = ik,   
                          aes(x= factor(""), y = vec , label = ech), 
                           color="red", size = 4, max.iter = 5000, 
                          box.padding=0, segment.alpha=0,   
                          direction="y", nudge_y = 650 )+    #bouger verticalement
  
          labs(shape = "Kinase", color = "Samples", #Renommenr les labels, titres et axes
               title="ADAM12 Expression",
               y="Normalized counts",
               x=" ")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=12),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 10),
              axis.text.y=element_text(colour="black", size = 10),
        legend.text = element_text(size=12),
        legend.position="right")+
  set.seed(3)
```


#ADAM12 siRNA
```{r}
iks = subset(exprsi, ech %in% c("KAT2A", "SIRT6") & gene == "ADAM12")

ggplot(data = exprsi) +
  
          geom_jitter(data = subset(exprsi, type %in% c("siRNA") & gene == "ADAM12" & !(ech  %in% c("KAT2A", "SIRT6"))), # extract ADAM12
                      aes(x= factor(""), y = vec , color = type), position=position_jitter(0.3), size=3) +
  
          geom_jitter(data = subset(exprsi, type %in% c("siCtrl") & gene == "ADAM12"), # extract ADAM12
                      aes(x= factor(""), y = vec , color = type) , position=position_jitter(0.1), size=3) +
    
  geom_hline(yintercept = thr_A12_si, color = "black", linetype = "dashed")+
  geom_hline(yintercept = thr_A12_si_plus, color = "black", size= 2)+
          scale_color_manual(values=c("black", "orange")) +
  
          labs(colour="") +  
  
          geom_point(data = subset(exprsi , (ech  %in% c("KAT2A", "SIRT6")) & (gene == "ADAM12")), 
                      aes( x= factor(""), y = vec , 
                           shape = "SIRT6 / KAT2A \n on ADAM12" ), color = "red ", size=3)+
          geom_text_repel(data = iks,   
                          aes(x= factor(""), y = vec , label = ech), 
                          #arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),
                          color="red", size = 4, max.iter = 5000,  force = 1,
                          box.padding=0, segment.alpha=1, segment.size=0.1,  
                          direction="both", nudge_y =0.8, nudge_x= c(2.5,0) )+    #bouger verticalement
  
  
          labs(shape = "siRNA", color = "Samples", #Renommenr les labels, titres et axes
               title="ADAM12 Expression",
               y="Normalized counts",
               x=" ")+
  theme_classic()+
  theme(plot.title = element_text(size = 12, face = "bold",hjust = 0.5),         #Mise en page
              text=element_text(),
              axis.title = element_text(face="bold", size=12),
              axis.text.x=element_text(angle=45, hjust=1,colour="black", size = 10),
              axis.text.y=element_text(colour="black", size = 10),
        legend.text = element_text(size=12),
        legend.position="right") 
```




